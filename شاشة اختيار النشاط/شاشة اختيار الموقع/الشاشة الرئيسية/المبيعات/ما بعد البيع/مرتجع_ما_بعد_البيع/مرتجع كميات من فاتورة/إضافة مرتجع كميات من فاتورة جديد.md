# إضافة مرتجع كميات من فاتورة جديد

## الوصف
شاشة إضافة مرتجع كميات جديد من فاتورة بيع محددة.

## الوظائف
- إدخال بيانات المرتجع الجديد
- ربط المرتجع بفاتورة البيع
- تحديد الكميات المرتجعة
- حساب المبالغ تلقائياً
- حفظ المرتجع الجديد
- العودة للقائمة الرئيسية

## الحقول المطلوبة
### بيانات المرتجع الأساسية
- **رقم السند** (إلزامي) - رقم تسلسلي
- **الرقم المرجعي** (إلزامي) - رقم مرجعي
- **رقم فاتورة البيع** (إلزامي) - قائمة منسدلة
- **العميل** (إلزامي) - قائمة منسدلة (يتم ملؤها تلقائياً)
- **الموقع** (إلزامي) - قائمة منسدلة (يتم ملؤها تلقائياً)
- **تاريخ السند** (إلزامي) - تاريخ

### تفاصيل الكميات المرتجعة
- **الصنف** (إلزامي) - قائمة منسدلة من أصناف الفاتورة
- **الكمية المرتجعة** (إلزامي) - رقم (لا يتجاوز الكمية المباعة)
- **الوحدة** (إلزامي) - قائمة منسدلة
- **سعر الوحدة** (إلزامي) - رقم (من الفاتورة الأصلية)
- **الإجمالي** (محسوب تلقائياً) - رقم

### المبالغ الإجمالية
- **إجمالي الكميات المرتجعة** (محسوب تلقائياً) - رقم
- **إجمالي الضرائب** (محسوب تلقائياً) - رقم
- **الإجمالي النهائي** (محسوب تلقائياً) - رقم

### تفاصيل إضافية
- **السبب** (إلزامي) - نص
- **الملاحظات** (اختياري) - نص طويل

## أزرار التحكم
- **حفظ**: لحفظ المرتجع الجديد
- **إلغاء**: للعودة للقائمة الرئيسية بدون حفظ
- **إضافة صنف**: لإضافة صنف آخر للارتجاع
- **حذف صنف**: لحذف الصنف المحدد
- **إعادة تعيين**: لمسح جميع الحقول
- **حساب تلقائي**: لحساب المبالغ تلقائياً

## التحقق من صحة البيانات
- التحقق من عدم تكرار رقم السند
- التحقق من صحة فاتورة البيع
- التحقق من صحة العميل والموقع
- التحقق من عدم تجاوز الكمية المرتجعة للكمية المباعة
- التحقق من صحة الأصناف والأسعار

## الربط الخلفي
- `Shared.API/Controllers/Sales/QuantityReturnController`
- `Shared.API/Controllers/Sales/SalesInvoiceController`
- `Shared.API/Controllers/Setup/CustomersController`
- `Shared.API/Controllers/Setup/LocationsController`

## التفاصيل التقنية
- التحقق من صحة البيانات المدخلة
- ربط المرتجع بفاتورة البيع
- حساب المبالغ تلقائياً
- تحديث رصيد العميل تلقائياً
- تحديث المخزون تلقائياً
- إنشاء القيود المحاسبية تلقائياً
- تحديث القائمة الرئيسية تلقائياً
- إدارة الأخطاء والاستثناءات
