# تقارير دورة المبيعات

## نظرة عامة
مجموعة شاملة من التقارير لمتابعة دورة المبيعات الكاملة من طلب التسعير حتى تحصيل المبالغ.

## كيفية الاستخدام

### 1. الوصول للشاشة
- من القائمة الرئيسية، اختر **التقارير**
- ثم اختر **تقارير دورة المبيعات**
- ستظهر قائمة بجميع تقارير دورة المبيعات المتاحة

### 2. اختيار التقرير المطلوب
ستجد **9 تقرير** منظمين حسب مراحل دورة المبيعات:

#### مرحلة الطلبات والعروض:
- **متابعة طلبات التسعير للعملاء** - طلبات العملاء للحصول على عروض أسعار
- **متابعة عروض الأسعار للعملاء** - عروض الأسعار المرسلة للعملاء
- **متابعة اعتمادات عروض الأسعار للعملاء** - اعتمادات العروض والمستندات الناتجة

#### مرحلة الاتفاقيات والتسليم:
- **متابعة اتفاقيات بيع** - عقود البيع المبرمة مع العملاء
- **متابعة بيان تسليم** - أذون تسليم البضاعة للعملاء
- **متابعة مرتجع من بيان تسليم** - مرتجعات التسليم

#### مرحلة الفواتير والمرتجعات:
- **متابعة فاتورة بيع مرحلية** - فواتير البيع المرحلية
- **متابعة مرتجع كميات من فاتورة مرحلية** - مرتجعات الفواتير
- **متابعة بضاعة محجوزة** - البضاعة المحجوزة للعملاء

## التقارير المتاحة بالتفصيل

### 1. متابعة طلبات التسعير للعملاء
**الغرض**: رصد طلبات العملاء للحصول على عروض أسعار وتتبّع ما تم عليها.

**الأعمدة**:
- **اسم السند**: نوع الطلب (طلب تسعير)
- **رقم السند**: رقم طلب التسعير
- **تاريخ السند**: تاريخ تقديم الطلب
- **السعر**: القيمة المقترحة/المتوقعة
- **اسم العميل**: العميل الذي طلب التسعير
- **الموقع**: المتجر أو الموقع الذي يتبع له الطلب
- **عرض أسعار العميل**: رقم عرض الأسعار الذي تم إصداره رداً على الطلب
- **اعتماد عرض أسعار العميل**: حالة اعتماد العرض
- **اتفاقية**: رقم الاتفاقية الناتجة عن العرض (إن وجدت)

### 2. متابعة عروض الأسعار للعملاء
**الغرض**: متابعة عروض الأسعار المرسلة للعملاء قبل اعتمادها أو تحويلها لاتفاقيات بيع.

**الأعمدة**: نفس أعمدة تقرير الاعتماد، مع عمود إضافي هو "اعتماد عرض أسعار العميل" الذي يُبيّن إذا ما تم اعتماد العرض أو لا.

### 3. متابعة اعتمادات عروض الأسعار للعملاء
**الغرض**: متابعة حالة اعتماد عروض الأسعار المرسلة للعملاء وتحويلها إلى اتفاقيات بيع ومستندات تنفيذ أخرى.

**الأعمدة**:
- **اسم السند / نوع المستند**: نوع المستند المرتبط بعرض السعر (مثل اتفاقية بيع، بيان تسليم)
- **رقم السند**: الرقم التسلسلي للمستند
- **تاريخ السند**: تاريخ إصدار المستند
- **السعر**: قيمة عرض السعر أو المستند المرتبط
- **اسم العميل**: اسم العميل الذي صدر له العرض
- **الموقع**: الموقع أو المتجر الذي صدر منه العرض
- **اعتماد عرض الأسعار**: حالة أو رقم اعتماد العرض من الإدارة أو العميل
- **اتفاقية بيع**: رقم الاتفاقية التي تحوّل إليها العرض
- **بيان تسليم**: رقم بيان التسليم الناتج عن الاتفاقية
- **مرتجع من بيان تسليم**: رقم مستند المرتجع إن تمت إعادة جزء من البضاعة
- **فاتورة مرحلية**: رقم الفاتورة المرحلية الصادرة
- **سند قبض**: رقم سند القبض المتعلق بتحصيل دفعة
- **مرتجع من فاتورة المبيعات**: رقم مستند المرتجع من الفاتورة
- **فاتورة مرتجع المبيعات**: رقم فاتورة المرتجع
- **إشعار مدين للعميل**: رقم إشعار الزيادة (رسوم إضافية)
- **إشعار دائن للعميل**: رقم إشعار الخصم
- **مرجع**: ملاحظات أو مرجع داخلي آخر

### 4. متابعة اتفاقيات بيع – مفصل
**الغرض**: متابعة الاتفاقيات (الفواتير الأولية/العقود) بصورة تفصيلية بما في ذلك البنود والكميات والتكاليف.

**الأعمدة**:
- **اسم السند**: نوع الاتفاقية (اتفاقية بيع)
- **رقم السند**: رقم الاتفاقية
- **تاريخ السند**: تاريخ توقيع الاتفاقية
- **الموقع**: اسم المتجر أو النشاط
- **باركود**: باركود الصنف (للتعرف على السلعة)
- **الصنف**: اسم الصنف المبيع
- **الوحدة**: وحدة القياس (حبة، علبة…)
- **الشد**: حزمة أو عبوة فرعية (إن وجدت)
- **الكمية**: كمية الصنف المتفق عليها
- **سعر**: سعر الوحدة
- **مركز التكلفة**: مركز التكلفة المرتبط بالعملية
- **كمية بيان تسليم**: كمية الصنف التي صدرت في بيان التسليم
- **كمية مرتجع من بيان تسليم**: الكمية المرتجعة من بيان التسليم
- **كمية فاتورة مرحلية**: الكمية التي تم إصدار فاتورة مرحلية بها
- **كمية مرتجع من فاتورة المبيعات**: الكمية المرتجعة من فاتورة المبيعات
- **سعر تكلفة الوحدة**: تكلفة شراء الوحدة (التكلفة)
- **إجمالي قيمة التكلفة**: التكلفة الكلية لهذه الكمية
- **فاتورة مرحلية/مرتجع**: أعمدة منفصلة تشير إلى أرقام الفواتير المرحلية أو فواتير المرتجع المرتبطة (عند وجودها)

### 5. متابعة بيان تسليم
**الغرض**: متابعة بيانات التسليم الصادرة للعملاء وما تلاها من مستندات (فواتير، مرتجعات...).

**الأعمدة**:
- **نوع المستند**: يوضح أنه بيان تسليم أو مستند لاحق
- **رقم المستند**: رقم بيان التسليم
- **تاريخ السند**: تاريخ إصدار البيان
- **السعر**: قيمة البضاعة في البيان
- **اسم العميل**: اسم العميل المستلم
- **الموقع**: اسم الموقع أو المتجر
- **مرتجع من بيان تسليم**: رقم المرتجع إن وجد
- **فاتورة مرحلية**: رقم الفاتورة الناتجة عن البيان
- **سند قبض**: رقم سند القبض المتعلق بالبيان
- **مرتجع من فاتورة المبيعات**: رقم مستند المرتجع
- **فاتورة مرتجع المبيعات**: رقم فاتورة المرتجع
- **إشعار مدين/دائن**: أرقام الإشعارات المرتبطة
- **مرجع**: ملاحظات

### 6. متابعة مرتجع من بيان تسليم
**الغرض**: متابعة المرتجعات من بيانات التسليم.

**الأعمدة**:
- **نوع المستند**: نوع المرتجع
- **رقم المستند**: رقم مستند المرتجع
- **تاريخ السند**: تاريخ إصدار المرتجع
- **السعر**: قيمة البضاعة المرتجعة
- **اسم العميل**: اسم العميل المرتجع
- **الموقع**: اسم الموقع أو المتجر
- **رقم بيان التسليم الأصلي**: رقم بيان التسليم المرتجع منه
- **سبب المرتجع**: سبب إرجاع البضاعة
- **حالة المرتجع**: حالة معالجة المرتجع
- **مرجع**: ملاحظات إضافية

### 7. متابعة فاتورة بيع مرحلية
**الغرض**: متابعة الفواتير المرحلية الصادرة للعملاء.

**الأعمدة**:
- **نوع المستند**: نوع الفاتورة (فاتورة مرحلية)
- **رقم المستند**: رقم الفاتورة المرحلية
- **تاريخ السند**: تاريخ إصدار الفاتورة
- **السعر**: قيمة الفاتورة المرحلية
- **اسم العميل**: اسم العميل المستحق
- **الموقع**: اسم الموقع أو المتجر
- **رقم بيان التسليم**: رقم بيان التسليم المرتبط
- **تاريخ الاستحقاق**: تاريخ استحقاق الدفع
- **المبلغ المدفوع**: المبلغ الذي تم دفعه
- **المبلغ المتبقي**: المبلغ المتبقي للدفع
- **حالة التحصيل**: حالة تحصيل الفاتورة
- **طريقة الدفع**: طريقة الدفع المستخدمة
- **مرجع**: ملاحظات

### 8. متابعة مرتجع كميات من فاتورة مرحلية
**الغرض**: متابعة المرتجعات من الفواتير المرحلية.

**الأعمدة**:
- **نوع المستند**: نوع مرتجع الفاتورة
- **رقم المستند**: رقم مستند مرتجع الفاتورة
- **تاريخ السند**: تاريخ إصدار مرتجع الفاتورة
- **السعر**: قيمة مرتجع الفاتورة
- **اسم العميل**: اسم العميل المرتجع
- **الموقع**: اسم الموقع أو المتجر
- **رقم الفاتورة المرحلية**: رقم الفاتورة المرتجع منها
- **سبب المرتجع**: سبب إرجاع الفاتورة
- **حالة المرتجع**: حالة معالجة مرتجع الفاتورة
- **تأثير على التحصيل**: تأثير المرتجع على التحصيل
- **مرجع**: ملاحظات

### 9. متابعة بضاعة محجوزة
**الغرض**: متابعة البضاعة المحجوزة للعملاء.

**الأعمدة**:
- **رقم الحجز**: رقم حجز البضاعة
- **تاريخ الحجز**: تاريخ حجز البضاعة
- **اسم العميل**: اسم العميل المحجوز له
- **الموقع**: اسم الموقع أو المتجر
- **الصنف**: اسم الصنف المحجوز
- **الكمية المحجوزة**: كمية البضاعة المحجوزة
- **الكمية المسلمة**: كمية البضاعة التي تم تسليمها
- **الكمية المتبقية**: كمية البضاعة المتبقية للحجز
- **تاريخ انتهاء الحجز**: تاريخ انتهاء صلاحية الحجز
- **حالة الحجز**: حالة الحجز (نشط، منتهي، ملغي)
- **رقم الاتفاقية**: رقم الاتفاقية المرتبطة بالحجز
- **مرجع**: ملاحظات

## كيفية الاستخدام

### 1. الوصول للشاشة
- من القائمة الرئيسية، اختر **التقارير**
- ثم اختر **تقارير دورة المبيعات**
- ستظهر قائمة بجميع تقارير دورة المبيعات المتاحة

### 2. اختيار التقرير المطلوب
ستجد **9 تقرير** منظمين حسب مراحل دورة المبيعات

### 3. فتح التقرير
- اضغط على اسم التقرير المطلوب
- ستنتقل إلى شاشة التقرير المحدد
- ستجد معايير البحث الخاصة بذلك التقرير

## مكونات الصفحة الرئيسية

### 1. شريط العنوان
```
┌─────────────────────────────────────────────────────────┐
│ تقارير دورة المبيعات                    [اسم المستخدم] │
│ آخر تحديث: [التاريخ والوقت]                            │
└─────────────────────────────────────────────────────────┘
```

### 2. شريط التنقل
```
┌─────────────────────────────────────────────────────────┐
│ [الرئيسية] > [التقارير] > [تقارير دورة المبيعات]      │
└─────────────────────────────────────────────────────────┘
```

### 3. قائمة التقارير
```
┌─────────────────────────────────────────────────────────┐
│ 📋 مرحلة الطلبات والعروض                               │
│ ├─ متابعة طلبات التسعير للعملاء                        │
│ ├─ متابعة عروض الأسعار للعملاء                         │
│ └─ متابعة اعتمادات عروض الأسعار للعملاء                │
│                                                         │
│ 📦 مرحلة الاتفاقيات والتسليم                           │
│ ├─ متابعة اتفاقيات بيع                                 │
│ ├─ متابعة بيان تسليم                                   │
│ └─ متابعة مرتجع من بيان تسليم                          │
│                                                         │
│ 📄 مرحلة الفواتير والمرتجعات                            │
│ ├─ متابعة فاتورة بيع مرحلية                            │
│ ├─ متابعة مرتجع كميات من فاتورة مرحلية                 │
│ └─ متابعة بضاعة محجوزة                                 │
└─────────────────────────────────────────────────────────┘
```

### 4. شريط البحث
```
┌─────────────────────────────────────────────────────────┐
│ 🔍 [بحث في التقارير...]                                │
└─────────────────────────────────────────────────────────┘
```

### 5. إحصائيات سريعة
```
┌─────────────────────────────────────────────────────────┐
│ 📊 إحصائيات سريعة                                      │
│ ├─ إجمالي التقارير: 9                                  │
│ ├─ آخر تقرير تم تشغيله: [اسم التقرير]                 │
│ ├─ طلبات معلقة: [العدد]                               │
│ └─ بضاعة محجوزة: [العدد]                              │
└─────────────────────────────────────────────────────────┘
```

## الميزات المشتركة لجميع التقارير

### 1. معايير البحث الموحدة
جميع التقارير تحتوي على معايير بحث مشتركة:

#### معايير إلزامية:
- **الفترة الزمنية**: من تاريخ - إلى تاريخ
- **الموقع**: اختيار الموقع أو المتجر

#### معايير اختيارية:
- **العميل**: اختيار عميل محدد أو جميع العملاء
- **حالة المستند**: (معلق، معتمد، مرفوض، مكتمل)
- **نوع الصنف**: اختيار مجموعة أصناف محددة

### 2. أزرار التحكم الموحدة
```
┌─────────────────────────────────────────────────────────┐
│ [عرض] [تصدير Excel] [تصدير PDF] [طباعة] [إعادة تعيين] │
└─────────────────────────────────────────────────────────┘
```

### 3. ميزات الجدول
- **ترتيب الأعمدة**: اضغط على عنوان العمود للترتيب
- **تصفية متقدمة**: أيقونة التصفية بجانب كل عمود
- **بحث في النتائج**: شريط البحث أعلى الجدول
- **تصدير محدد**: تحديد صفوف معينة للتصدير

## المميزات المشتركة
- **التصدير**: جميع التقارير تدعم التصدير بصيغ Excel و PDF
- **الطباعة**: إمكانية طباعة جميع التقارير
- **التصفية**: تصفية متقدمة حسب الفترة والموقع والعملاء
- **التحديث المباشر**: تحديث البيانات في الوقت الفعلي
- **المتابعة المتسلسلة**: ربط المستندات ببعضها البعض لمتابعة دورة المبيعات كاملة

## نصائح للاستخدام

### 1. للمتابعة اليومية
- راجع **متابعة طلبات التسعير للعملاء** للطلبات الجديدة
- تحقق من **متابعة اعتمادات عروض الأسعار** للاعتمادات المعلقة
- راجع **متابعة بيان تسليم** للتسليمات اليومية

### 2. للمراجعة الأسبوعية
- استخدم **متابعة اتفاقيات بيع** لمراجعة العقود الجديدة
- راجع **متابعة فاتورة بيع مرحلية** للفواتير المستحقة
- تحقق من **متابعة مرتجع من بيان تسليم** للمرتجعات

### 3. للتحليل الشهري
- استخدم **متابعة عروض الأسعار للعملاء** لتحليل العروض
- راجع **متابعة طلبات التسعير للعملاء** لتحليل الطلبات
- استخدم تصدير Excel للتحليل المتقدم

### 4. للتحكم في المخزون
- راجع **متابعة بضاعة محجوزة** لتخطيط المخزون
- استخدم **متابعة بيان تسليم** لمراجعة التسليمات
- تحقق من **متابعة مرتجع كميات** لتحليل المرتجعات

## استكشاف الأخطاء

### مشكلة: لا تظهر نتائج
- **الحل**: تأكد من تحديد الفترة الزمنية والموقع
- **الحل**: تحقق من وجود بيانات في الفترة المحددة
- **الحل**: تأكد من صلاحيات الوصول للتقارير

### مشكلة: بيانات غير مكتملة
- **الحل**: راجع **متابعة طلبات التسعير للعملاء** للطلبات المعلقة
- **الحل**: تحقق من **متابعة اعتمادات عروض الأسعار** للاعتمادات المعلقة
- **الحل**: راجع **متابعة بيان تسليم** للتسليمات المعلقة

### مشكلة: بطء في التحميل
- **الحل**: قلل الفترة الزمنية
- **الحل**: اختر موقع محدد
- **الحل**: استخدم معايير تصفية إضافية

### مشكلة: عدم تطابق الأرقام
- **الحل**: راجع **متابعة اتفاقيات بيع** مع **متابعة بيان تسليم**
- **الحل**: تحقق من **متابعة مرتجع من بيان تسليم**
- **الحل**: راجع **متابعة فاتورة بيع مرحلية**

## الربط الخلفي
`Shared.API/Controllers/Reports/SalesCycleReportsController`
